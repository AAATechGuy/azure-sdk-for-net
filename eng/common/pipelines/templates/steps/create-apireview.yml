# This Yaml Document has been converted by ESAI Yaml Pipeline Conversion Tool.
# Please make sure to check all the converted content, it is your team's responsibility to make sure that the pipeline is still valid and functions as expected.
parameters:
  ArtifactPath: $(Build.ArtifactStagingDirectory)
  Artifacts: []
  ConfigFileDir: $(Build.ArtifactStagingDirectory)/PackageInfo
steps:
- template: /eng/common/pipelines/templates/steps/set-default-branch.yml@self
- ${{ each artifact in parameters.Artifacts }}:
  - task: Powershell@2
    inputs:
      filePath: $(Build.SourcesDirectory)/eng/common/scripts/Create-APIReview.ps1
      arguments: >
        -ArtifactPath ${{parameters.ArtifactPath}} -APIViewUri $(azuresdk-apiview-uri) -APIKey $(azuresdk-apiview-apikey) -APILabel "Auto Review - $(Build.SourceVersion)" -PackageName ${{artifact.name}} -SourceBranch $(Build.SourceBranchName) -DefaultBranch $(DefaultBranch) -ConfigFileDir '${{parameters.ConfigFileDir}}'
      pwsh: true
      workingDirectory: $(Pipeline.Workspace)
    displayName: Create API Review for ${{ artifact.name}}
    condition: >-
      and(
        succeededOrFailed(),
        ne(variables['Skip.CreateApiReview'], 'true'),
        ne(variables['Build.Reason'],'PullRequest'),
        eq(variables['System.TeamProject'], 'internal'),
        not(endsWith(variables['Build.Repository.Name'], '-pr'))
      )